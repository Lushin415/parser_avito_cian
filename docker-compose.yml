services:
  realty-monitor:
    container_name: realty-monitor
    build:
      context: .
      dockerfile: Dockerfile
    restart: unless-stopped
    ports:
      - "8009:8009"
    volumes:
      # Конфиг (read-only)
      - ./config.toml:/app/config.toml:ro
      # Персистентные данные (БД с пользователями и viewed-записями)
      - ./database.db:/app/database.db
      # Cookies (обновляются Playwright-ом)
      - ./cookies.json:/app/cookies.json
      - ./cookies_cian.json:/app/cookies_cian.json
      # Логи
      - ./logs:/app/logs
    environment:
      - TZ=Europe/Moscow
    healthcheck:
      test: ["CMD", "curl", "-sf", "http://localhost:8009/health"]
      interval: 30s
      timeout: 5s
      start_period: 15s
      retries: 3
